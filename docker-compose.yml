version: '3.9'
volumes:
    nextcloud:
    db:
networks:
  next_maria:
  next_web:

services:
    db:
        image: mariadb
        container_name: mariaDB
        command : --transaction-isolation=READ-COMMITTED --binlog-format=ROW
        restart: always
        volumes:
            - db:/var/lib/mysql
        environment:
            - MYSQL_ROOT_PASSWORD=100298
            - MYSQL_PASSWORD=100298
            - MYSQL_DATABASE=nextcloud
            - MYSQL_USER=nextcloud
        networks:
            - next_maria
            
    nextcloud:
      image: nextcloud
      container_name: nextcloud_app
      ports:
          - 8080:80
      volumes:
          - nextcloud:/var/www/html
      environment:
          - NEXTCLOUD_ADMIN_USER=fmanenc
          - NEXTCLOUD_ADMIN_PASSWORD=123456
          - NEXTCLOUD_TRUSTED_DOMAINS=localhost:8090
          - MYSQL_DATABASE=nextcloud
          - MYSQL_USER=nextcloud
          - MYSQL_PASSWORD=100298
          - MYSQL_HOST=db
      restart: always
      networks:
          - next_maria
          - next_web
    services:

  traefik:
    image: "traefik:v2.4"
    container_name: "traefik"
    command:
      #- "--log.level=DEBUG"
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"

  whoami:
    image: "traefik/whoami"
    container_name: "simple-service"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.whoami.rule=Host(`localhost:8090`)"
      - "traefik.http.routers.whoami.entrypoints=web"
